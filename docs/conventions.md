
# Conventions

These conventions exist to keep the project **diff-friendly**, **stable**, and easy for AI (and humans) to change safely.

## Golden rules

- No secrets in this repo (see `docs/security.md`).
- Prefer boring, proven defaults.
- Avoid formatting-only churn.
- Stable IDs are never renamed or reused.

## Architecture invariants

- Go (`core-go`) owns: discovery, normalisation, persistence, REST API.
- Node.js (`ui-node`) owns: UI rendering, workflows, auth UI + sessions.
- Node **must not** scan networks and **must not** access the database.
- Database is **PostgreSQL only**.

## API conventions

- Base path: `/api/v1`
- JSON only.
- Errors use a consistent envelope (see `docs/api-contract.md`).
- OpenAPI is canonical: `api/openapi.yaml`.

## IDs

- IDs are UUIDs.
- Persisted record IDs are generated by PostgreSQL (default `gen_random_uuid()`).
- IDs are treated as opaque strings in the API.

## Logging

All services emit structured JSON logs.

Required fields where applicable:

- `service`
- `request_id`
- `method`
- `path`
- `status`
- `duration_ms`

## Change management

- If you change API behavior, update:

  - `api/openapi.yaml`
  - `docs/api-contract.md`
- If you change data shapes or relationships, update:

  - `docs/data-model.md`
  - migrations (when they exist)
- If you change service boundaries, update:

  - `docs/architecture.md`

## UI conventions

Operator-facing UX behavior (loading/error states, navigation, primitives, accessibility expectations) is documented in:

- `docs/ui-ux.md`

If you change UI behavior in a way that affects operator workflows, update that document alongside the code.
