# API contract

This document describes the API rules for Roller_hoops. The API is a **contract**, not an implementation detail.

## Principles

- REST over HTTP
- JSON only
- Explicit error responses (no silent failures)
- Versioned endpoints for stability (`/api/v1`)
- Stable IDs (UUIDs as strings)

## Canonical source

- OpenAPI is canonical: `api/openapi.yaml`
- This document explains conventions and non-obvious rules.

## Versioning

- Current version: `/api/v1`
- Breaking changes require a new version (`/api/v2`).

## Common headers

- Request correlation:
  - `X-Request-Id`: accepted from upstream, otherwise generated by the API.

## Error format

All non-2xx responses return JSON using a consistent envelope:

- `error.code` (stable string)
- `error.message` (human-readable)
- `error.details` (optional object)

Example shape:

```json
{
  "error": {
    "code": "validation_failed",
    "message": "Request body did not match schema",
    "details": {
      "field": "name"
    }
  }
}
```

## Resource conventions

- IDs are UUID strings.
- `PUT` is used for full updates of a resource.
- `POST` is used for creates and command-style actions.

## Endpoints (v1)

Initial endpoints (from `docs/roadmap.md`):

- Devices
  - `GET /api/v1/devices`
  - `GET /api/v1/devices/{id}`
  - `POST /api/v1/devices`
  - `PUT /api/v1/devices/{id}`

- Discovery
  - `POST /api/v1/discovery/run`
  - `GET /api/v1/discovery/status`

## Authentication

v1 intent:

- Authentication and sessions are owned by **ui-node**.
- `core-go` remains headless and is only routed via Traefik.

(Exact auth propagation and authorization rules will be pinned in OpenAPI and `docs/architecture.md` once the first implementation lands.)
